---
title: "MAPS Crowdsourced Open Science Project: Data Exploration"
author: "Corey Pembleton"
date: '2019-04-27'
output: html_document
slug: crowdsourced-open-science-project-data-exploration
categories: [ "R", "dataexploration"]
tags: ["data cleaning", "statistics", "naniar"]
thumbnailImagePosition: "left"
draft: true 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
suppressWarnings(suppressPackageStartupMessages(library(tidyverse)))
library(kableExtra)
```

In my previous post I explain the goals of this research project, and now that I have access to the data, it's time to dig in and have a look at the data used for the analysis, how gaps in the data were imputed, and what other approaches could be used.

### Synthetic Data 

One of the contributors of the MAPS study, [Robert Arbon](https://twitter.com/BertieArbon), created a synthesized version of the ALSPAC dataset using the R ```SynthPop``` package to account for privacy concerns in the data, and gave a detailed documentation on how the synthetic dataset (the one which will be used for this present MAPS study) was created.

### Missing Data & Imputations

the large amounts of missing data (only 12.7% of participants had complete data on outcomes, exposure, and covariates). They describe the method as being similar to the Multiple Imputation by Chained Equations (MICE) method (described in detail [here](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3074241/)). 

The flow of how the authors arrived at only 12.7% of participants having completed the required outcomes/exposures/covariates looks like this:

![](/img/data-flow.png)

In this post, I would like to explore the missing data further to gain an understanding of the data used for the study, how it was imputated, and what implications this could have on future analytic stages.

#### Libraries Used

I will be using ```naniar``` and ```simputation``` along with the usual ```tidyverse``` suspects throughout this post.

```{r, cache=TRUE, error=FALSE, warning=FALSE, message=FALSE}
orig_dat <- read_csv("https://raw.githubusercontent.com/pembletonc/OpenNorth_MAPS/master/maps-synthetic-data.csv") %>% rename(ID = X1)
```


## Find out what's missing
As a first step, I would like to replicate the graphic in the figure above using the synthetic dataset provided by the Bristol research team.

The second figure in the flow diagram features 14,665 "live born offspring (singletons and twins) who had not withdrawn from the study", which is my entire N population:

```{r}

nrow(orig_dat)

```

The synthetic dataset provided has 13,734 participants, 1,291 less than that used in the study. This difference isn't explicitly explained, but it is implied that is the result of removing any rows in common with the original dataset. 

The next figure in the flow diagram, 4,562, is the number of participants who completed the CIS-R at the age of 18. This is either the variables ```dep_score``` or ```dep_thoughts```:

```{r}
orig_dat %>% filter(!is.na(dep_score)) %>% summarise(count=n())

orig_dat %>% filter(!is.na(dep_thoughts)) %>% summarise(count=n())
```

Looks like the score is the variable that has been used. The third figure in line, the exposure variable, is 3,009 participants with "exposure information at age 16", meaning those who had screentime at the age of 16. The authors of the study look at three types of screen use on weekdays and weekends: television screens, texting, and computer screens. I have saved these variables for computer use ```vars_model1```:

```{r}
#time to write a function for this!
filter.NA.fun <- function(df, var){ 
  
  var <- enquo(var)
  
  df %>% 
    select(one_of(!!var)) %>%
    filter_all(all_vars(!is.na(.))) %>% 
    summarise(count = n()) 
  } 

vars_model1 <- c("dep_score", "text_wend", "text_week", "tv_wend", "tv_week",
          "comp_week", "comp_wend")

filter.NA.fun(orig_dat, vars_model1)

```

Which gives a count of 3,043, not far from the original 3,009. In the second model, the authors look at the variables in model 1, with nine additional covariates:

```{r}
vars_model2 <- c("dep_score", "text_wend", "text_week", "tv_wend", "tv_week",
                 "comp_week", "comp_wend", "sex","anx_band_15",
                 "mat_anx_0m","mat_anx_1","mat_anx_18m", "mat_anx_8m",
                 "mat_dep", "mat_edu", "mat_ses")


filter.NA.fun(orig_dat, vars_model2)

```

reducing the count of applicable data to 1,945 for model 2. Model 3 includes another 11 variables on top of those in model 2, for a total of 1,575: 

```{r}
vars_model3 <- c("dep_score", "text_wend", "text_week", "tv_wend", "tv_week",
                 "comp_week", "comp_wend", "sex","anx_band_15",
                 "mat_anx_0m","mat_anx_1","mat_anx_18m", "mat_anx_8m",
                 "mat_dep", "mat_edu", "mat_ses", "iq", "pat_pres", 
                 "pat_pres_10", "pat_pres_8", "num_home", "phys_cruel", "emot_cruel",
                 "child_bull","fam_tv_aft", "fam_tv_eve", "fam_tv_mor")

filter.NA.fun(orig_dat, vars_model3)

```

Which begs the question, which "covariate information" is included in the final 1,869? It seems that it may be with model 2 only, as model 3 has nearly 300 participants missing.

The last and final determinant of participant relevance to the study, is the inclusion of a wide range of covariates, which the authors include in additional models 4a to 4l:


> "Each of the sub-models of model 4 additionally adjusted for time spent engaging in one other activity on weekdays or weekends (time alone [model 4a], on transport [model 4b], playing outdoors in summer [model 4c], playing outdoors in winter [model 4d], playing with others [model 4e], drawing, making or constructing things [model 4f], exercising [model 4g], completing school or college work [model 4h], reading [model 4i], playing musical instruments [model 4j], talking on a mobile phone [model 4k] and talking on a landline phone [model 4l])."

To get an idea of what the differences are in data availability across each of the models, I can test and review them using ```purrr::map()``` (variable model lists not shown)):

```{r, echo=FALSE}

vars_model4a <- c("dep_score", "text_wend", "text_week", "tv_wend", "tv_week",
                 "comp_week", "comp_wend", "sex","anx_band_15",
                 "mat_anx_0m","mat_anx_1","mat_anx_18m", "mat_anx_8m",
                 "mat_dep", "mat_edu", "mat_ses", "iq", "pat_pres", 
                 "pat_pres_10", "pat_pres_8", "num_home", "phys_cruel", "emot_cruel",
                 "child_bull","fam_tv_aft", "fam_tv_eve", "fam_tv_mor",
                 "alon_week", "alon_day")

vars_model4b <- c("dep_score", "text_wend", "text_week", "tv_wend", "tv_week",
                  "comp_week", "comp_wend", "sex","anx_band_15",
                  "mat_anx_0m","mat_anx_1","mat_anx_18m", "mat_anx_8m",
                  "mat_dep", "mat_edu", "mat_ses", "iq", "pat_pres", 
                  "pat_pres_10", "pat_pres_8", "num_home", "phys_cruel", "emot_cruel",
                  "child_bull","fam_tv_aft", "fam_tv_eve", "fam_tv_mor",
                  "tran_week","tran_wend")

vars_model4c <- c("dep_score", "text_wend", "text_week", "tv_wend", "tv_week",
                  "comp_week", "comp_wend", "sex","anx_band_15",
                  "mat_anx_0m","mat_anx_1","mat_anx_18m", "mat_anx_8m",
                  "mat_dep", "mat_edu", "mat_ses", "iq", "pat_pres", 
                  "pat_pres_10", "pat_pres_8", "num_home", "phys_cruel", "emot_cruel",
                  "child_bull","fam_tv_aft", "fam_tv_eve", "fam_tv_mor",
                  "out_sum_wend", "out_sum_week")

vars_model4d <- c("dep_score", "text_wend", "text_week", "tv_wend", "tv_week",
                  "comp_week", "comp_wend", "sex","anx_band_15",
                  "mat_anx_0m","mat_anx_1","mat_anx_18m", "mat_anx_8m",
                  "mat_dep", "mat_edu", "mat_ses", "iq", "pat_pres", 
                  "pat_pres_10", "pat_pres_8", "num_home", "phys_cruel", "emot_cruel",
                  "child_bull","fam_tv_aft", "fam_tv_eve", "fam_tv_mor",
                  "out_win_wend", "out_win_week")

vars_model4e <- c("dep_score", "text_wend", "text_week", "tv_wend", "tv_week",
                  "comp_week", "comp_wend", "sex","anx_band_15",
                  "mat_anx_0m","mat_anx_1","mat_anx_18m", "mat_anx_8m",
                  "mat_dep", "mat_edu", "mat_ses", "iq", "pat_pres", 
                  "pat_pres_10", "pat_pres_8", "num_home", "phys_cruel", "emot_cruel",
                  "child_bull","fam_tv_aft", "fam_tv_eve", "fam_tv_mor",
                  "play_week", "play_wend")

vars_model4f <- c("dep_score", "text_wend", "text_week", "tv_wend", "tv_week",
                  "comp_week", "comp_wend", "sex","anx_band_15",
                  "mat_anx_0m","mat_anx_1","mat_anx_18m", "mat_anx_8m",
                  "mat_dep", "mat_edu", "mat_ses", "iq", "pat_pres", 
                  "pat_pres_10", "pat_pres_8", "num_home", "phys_cruel", "emot_cruel",
                  "child_bull","fam_tv_aft", "fam_tv_eve", "fam_tv_mor",
                  "draw_week", "draw_wend")

vars_model4g <- c("dep_score", "text_wend", "text_week", "tv_wend", "tv_week",
                  "comp_week", "comp_wend", "sex","anx_band_15",
                  "mat_anx_0m","mat_anx_1","mat_anx_18m", "mat_anx_8m",
                  "mat_dep", "mat_edu", "mat_ses", "iq", "pat_pres", 
                  "pat_pres_10", "pat_pres_8", "num_home", "phys_cruel", "emot_cruel",
                  "child_bull","fam_tv_aft", "fam_tv_eve", "fam_tv_mor",
                  "exercise")

vars_model4h <- c("dep_score", "text_wend", "text_week", "tv_wend", "tv_week",
                  "comp_week", "comp_wend", "sex","anx_band_15",
                  "mat_anx_0m","mat_anx_1","mat_anx_18m", "mat_anx_8m",
                  "mat_dep", "mat_edu", "mat_ses", "iq", "pat_pres", 
                  "pat_pres_10", "pat_pres_8", "num_home", "phys_cruel", "emot_cruel",
                  "child_bull","fam_tv_aft", "fam_tv_eve", "fam_tv_mor",
                  "work_wend", "work_week")

vars_model4i <- c("dep_score", "text_wend", "text_week", "tv_wend", "tv_week",
                  "comp_week", "comp_wend", "sex","anx_band_15",
                  "mat_anx_0m","mat_anx_1","mat_anx_18m", "mat_anx_8m",
                  "mat_dep", "mat_edu", "mat_ses", "iq", "pat_pres", 
                  "pat_pres_10", "pat_pres_8", "num_home", "phys_cruel", "emot_cruel",
                  "child_bull","fam_tv_aft", "fam_tv_eve", "fam_tv_mor",
                  "read_wend", "read_week")

vars_model4j <- c("dep_score", "text_wend", "text_week", "tv_wend", "tv_week",
                  "comp_week", "comp_wend", "sex","anx_band_15",
                  "mat_anx_0m","mat_anx_1","mat_anx_18m", "mat_anx_8m",
                  "mat_dep", "mat_edu", "mat_ses", "iq", "pat_pres", 
                  "pat_pres_10", "pat_pres_8", "num_home", "phys_cruel", "emot_cruel",
                  "child_bull","fam_tv_aft", "fam_tv_eve", "fam_tv_mor",
                  "musi_wend", "musi_week")

vars_model4k <- c("dep_score", "text_wend", "text_week", "tv_wend", "tv_week",
                  "comp_week", "comp_wend", "sex","anx_band_15",
                  "mat_anx_0m","mat_anx_1","mat_anx_18m", "mat_anx_8m",
                  "mat_dep", "mat_edu", "mat_ses", "iq", "pat_pres", 
                  "pat_pres_10", "pat_pres_8", "num_home", "phys_cruel", "emot_cruel",
                  "child_bull","fam_tv_aft", "fam_tv_eve", "fam_tv_mor",
                  "talk_mob_week", "talk_mob_wend")


vars_model4l <- c("dep_score", "text_wend", "text_week", "tv_wend", "tv_week",
                  "comp_week", "comp_wend", "sex","anx_band_15",
                  "mat_anx_0m","mat_anx_1","mat_anx_18m", "mat_anx_8m",
                  "mat_dep", "mat_edu", "mat_ses", "iq", "pat_pres", 
                  "pat_pres_10", "pat_pres_8", "num_home", "phys_cruel", "emot_cruel",
                  "child_bull","fam_tv_aft", "fam_tv_eve", "fam_tv_mor",
                  "talk_phon_week", "talk_phon_wend")

```

```{r}
all_model_vars <- list(vars_model1 = vars_model1, vars_model2 = vars_model2,
                       vars_model3 = vars_model3,  vars_model4a = vars_model4a,
                       vars_model4b = vars_model4b,
                       vars_model4c = vars_model4c, vars_model4d = vars_model4d,
                       vars_model4e = vars_model4e, vars_model4f = vars_model4f,
                       vars_model4g = vars_model4g, vars_model4h = vars_model4h,
                       vars_model4i = vars_model4i, vars_model4j = vars_model4j,
                       vars_model4k = vars_model4k, vars_model4l = vars_model4l)

map_df(all_model_vars, filter.NA.fun, df = orig_dat) %>%
  add_column(model = names(all_model_vars)) %>% 
  kableExtra::kable() %>% kableExtra::kable_styling(bootstrap_options = c("striped"))

```



### Exploring the missings


